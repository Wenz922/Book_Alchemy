<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Library Home</title>
    </head>
    <body>

        <h2> My Book Library </h2>

        <form method="get" action="/" class="search-box">
            <input type="text" name="q" placeholder="Search by title, author, or ISBN" value="{{ search_query }}">
            <button type="submit">Search</button>
        </form>

        <div class="controls">
            <strong>Sort by:</strong>
            <a href="/?sort=title" class="button">Title</a>
            <a href="/?sort=author" class="button">Author</a>
            <a href="/?sort=year" class="button">Year</a>
        </div>

        {% if message %}
            <p><strong>{{ message }}</strong></p>
        {% endif %}

        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for msg in messages %}
                    <p><strong>{{ msg }}</strong></p>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% for book in books %}
            <div class="book">
                {% if book.cover_url %}
                    <img src="{{ book.cover_url }}" alt="Cover for {{ book.title }}">
                {% endif %}
                <div>
                    <h3>{{ book.title }}</h3>
                    <p><strong>Author:</strong> {{ book.author.name }}</p>

                    <form action="{{ url_for('delete_author', author_id=book.author.id) }}" method="POST">
                        <button type="submit">Delete Author</button>
                    </form>

                    {% if book.publication_year %}
                        <p><strong>Year:</strong> {{ book.publication_year }}</p>
                    {% endif %}
                    <p><strong>ISBN:</strong> {{ book.isbn }}</p>

                    <form action="{{ url_for('delete_book', book_id=book.id) }}" method="POST">
                        <button type="submit">Delete Book</button>
                    </form>
                </div>
            </div>
        {% endfor %}

    </body>
</html>